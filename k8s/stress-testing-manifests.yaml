# This file contains example manifests for stress testing pods
# These are dynamically generated by the run_stress_experiments.sh script
# but provided here as reference templates

---
# CPU Stress Pod Template
apiVersion: v1
kind: Pod
metadata:
  name: stress-cpu-example
  labels:
    app: stress-cpu
spec:
  nodeSelector:
    kubernetes.io/hostname: NODE_NAME # Will be replaced dynamically
  containers:
    - name: stress-ng
      image: colinianking/stress-ng
      command: ["stress-ng"]
      args:
        - "--cpu"
        - "0" # Use all available CPUs
        - "--cpu-load"
        - "50" # CPU load percentage (will be replaced dynamically)
        - "--timeout"
        - "300s" # Duration (will be replaced dynamically)
        - "--metrics-brief"
      resources:
        requests:
          cpu: "100m"
          memory: "128Mi"
        limits:
          cpu: "2000m"
          memory: "256Mi"

---
# Network Stress - iperf3 Server Template
apiVersion: v1
kind: Pod
metadata:
  name: iperf3-server-example
  labels:
    app: iperf3-server
spec:
  nodeSelector:
    kubernetes.io/hostname: NODE_NAME # Will be replaced dynamically
  containers:
    - name: iperf3
      image: networkstatic/iperf3:latest
      command: ["iperf3"]
      args: ["-s", "-p", "5201"]
      ports:
        - containerPort: 5201
      resources:
        requests:
          cpu: "100m"
          memory: "64Mi"
        limits:
          cpu: "500m"
          memory: "128Mi"

---
# Network Stress - iperf3 Client Template
apiVersion: v1
kind: Pod
metadata:
  name: iperf3-client-example
  labels:
    app: iperf3-client
spec:
  containers:
    - name: iperf3
      image: networkstatic/iperf3:latest
      command: ["sh", "-c"]
      args:
        - |
          SERVER_IP=$(getent hosts iperf3-server-example | awk '{ print $1 }')
          if [ -z "$SERVER_IP" ]; then
            echo "Failed to resolve iperf3 server"
            exit 1
          fi
          echo "Connecting to iperf3 server at $SERVER_IP"
          iperf3 -c $SERVER_IP -p 5201 -b 100M -t 300  # Bandwidth and duration will be replaced
      resources:
        requests:
          cpu: "100m"
          memory: "64Mi"
        limits:
          cpu: "500m"
          memory: "128Mi"

---
# Combined Stress Pod (CPU + Memory + IO)
apiVersion: v1
kind: Pod
metadata:
  name: stress-combined-example
  labels:
    app: stress-combined
spec:
  nodeSelector:
    kubernetes.io/hostname: NODE_NAME
  containers:
    - name: stress-ng
      image: colinianking/stress-ng
      command: ["stress-ng"]
      args:
        - "--cpu"
        - "2"
        - "--cpu-load"
        - "50"
        - "--vm"
        - "1"
        - "--vm-bytes"
        - "128M"
        - "--io"
        - "1"
        - "--timeout"
        - "300s"
        - "--metrics-brief"
      resources:
        requests:
          cpu: "200m"
          memory: "256Mi"
        limits:
          cpu: "2000m"
          memory: "512Mi"
